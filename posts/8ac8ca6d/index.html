<html>
<!DOCTYPE HTML>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  
  <title>HPC 配置深度学习环境 | OMEGA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  
    <meta name="author" content="Hongjiang Qian">
  
  
    <meta name="description" content="Step 1 连接 HPC 中心 (Linux/Mac OS)在 Mac terminal 中运行以下的代码ssh yournetid@login.storrs.hpc.uconn.edu通常此时会要求输入密码。
为了避免每次都输入很长的命令，我们可以自定义 ssh 别名">
  
  <meta name="description" content="Step 1 连接 HPC 中心 (Linux&#x2F;Mac OS)在 Mac terminal 中运行以下的代码ssh yournetid@login.storrs.hpc.uconn.edu通常此时会要求输入密码。 为了避免每次都输入很长的命令，我们可以自定义 ssh 别名">
<meta property="og:type" content="article">
<meta property="og:title" content="HPC 配置深度学习环境">
<meta property="og:url" content="http://hjqian96.github.io/math/posts/8ac8ca6d/index.html">
<meta property="og:site_name" content="OMEGA">
<meta property="og:description" content="Step 1 连接 HPC 中心 (Linux&#x2F;Mac OS)在 Mac terminal 中运行以下的代码ssh yournetid@login.storrs.hpc.uconn.edu通常此时会要求输入密码。 为了避免每次都输入很长的命令，我们可以自定义 ssh 别名">
<meta property="og:locale">
<meta property="article:published_time" content="2020-10-02T21:13:59.000Z">
<meta property="article:modified_time" content="2020-11-11T21:59:11.000Z">
<meta property="article:author" content="Hongjiang Qian">
<meta name="twitter:card" content="summary">
  
  
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
  
  
<link rel="stylesheet" href="../../css/style.css">

  <!--[if lt IE 9]><script src="//cdn.bootcss.com/html5shiv/3.7.0/html5shiv.min.js"></script><![endif]-->
  

  
  
<!-- //插入统计代码 -->

  <link rel="stylesheet" href="/math/css/font-awesome.css" media="screen" type="text/css">

  <link rel="stylesheet" href="/math/css/vs.css" media="screen" type="text/css">

<meta name="generator" content="Hexo 5.2.0"><!-- hexo-inject:begin --><!-- hexo-inject:end --><link rel="stylesheet" href="/math/css/prism.css" type="text/css"></head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="wrapper">
    <header id="header">
  <div class="title">
    <h1><a href="/math/">OMEGA</a></h1>
    <p><a href="/math/">Write what you&#39;ve down and make your work available.</a></p>
  </div>
  <nav class="nav">
    <ul>
      
        <li><a href="/math/">Home</a></li>
      
        <li><a href="/math/archives/">Archives</a></li>
      
        <li><a href="/math/Reading/">Reading</a></li>
      
        <li><a href="/math/Misc/">Misc</a></li>
      
        <li><a href="/math/About/">About</a></li>
      
      
    </ul>
    <div class="clearfix"></div>
  </nav>
  <div class="clearfix"></div>
</header>
    <div class="content"><article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/math/posts/8ac8ca6d/">
  <time datetime="2020-10-02T21:13:59.000Z">
    2020-10-02
  </time>
</a>
    
    
  
    <h1 class="title">HPC 配置深度学习环境</h1>
  

  </header>

  

  <div class="entry">
    
      <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h3 id="Step-1-连接-HPC-中心-Linux-Mac-OS"><a href="#Step-1-连接-HPC-中心-Linux-Mac-OS" class="headerlink" title="Step 1 连接 HPC 中心 (Linux/Mac OS)"></a>Step 1 连接 HPC 中心 (Linux/Mac OS)</h3><p>在 Mac terminal 中运行以下的代码<br><code>ssh yournetid@login.storrs.hpc.uconn.edu</code><br>通常此时会要求输入密码。</p>
<p>为了避免每次都输入很长的命令，我们可以自定义 ssh 别名<br><a id="more"></a></p>
<pre class=" language-lang-python"><code class="language-lang-python">import time
import numpy as np
import pandas as pd
import tensorflow as tf
from tensorflow import keras
import matplotlib.pyplot as plt

get_ipython().run_line_magic('matplotlib', 'inline')
get_ipython().run_line_magic('config', "InlineBackend.figure_format = 'svg'")

#set suppress to not use scientific counting
np.set_printoptions(suppress=True)
</code></pre>
<pre class=" language-lang-bash"><code class="language-lang-bash">cd ~./ssh
touch config  #如果这里没有config文件
vim config  # 用Vim 编辑config文件
</code></pre>
<p>在 <code>vim config</code> 之后, 在 vim 编辑器写入一下代码</p>
<pre class=" language-lang-python"><code class="language-lang-python">Host uconn-hpc  # the short name you want
    Hostname login.storrs.hpc.uconn.edu
    User hoq20002  #你的login id
    ForwardAgent no
</code></pre>
<p>然后，就可以直接通过 <code>ssh uconn-hpc</code> 连接学校的 HPC 中心了。</p>
<h3 id="Step-2-conda-配置Python环境"><a href="#Step-2-conda-配置Python环境" class="headerlink" title="Step 2 conda 配置Python环境"></a>Step 2 conda 配置Python环境</h3><p>下面以Deep_Filter项目为例</p>
<pre class=" language-lang-Bash"><code class="language-lang-Bash">mkdir Deep_Filter
cd Deep_Filter #单独建立一个folder后进入
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh  # download 最新的miniconda 包
bash Miniconda3-latest-Linux-x86_64.sh -b -p miniconda

module load cuda/10.1      #具体的version 需要参考学校 HPC 提供的 module, 可用 module avail 查看
module load cudnn/7.6.5

# 创建一个名为 pyGPUrtx 的 python 环境

miniconda/bin/conda create -n pyGPUrtx python=3.8.3  
source miniconda/bin/activate pyGPUrtx
# 在激活 pyGPUrtx 之后就可以安装所需要的 python pacakage

pip install tensorflow
pip install keras
pip install matplotlib
pip install sklearn
pip install pandas
</code></pre>
<p>基本按照上述操作就可以配置好深度学习所需要的环境。注意：不要在 login mode 下直接 pip 安装所需要的 package, 此时一般不会安装成功。最好就是先用 conda 创建自己的 python 环境, 再安装需要的包。</p>
<h3 id="Step-3-Slurm-submit-job"><a href="#Step-3-Slurm-submit-job" class="headerlink" title="Step 3: Slurm submit job"></a>Step 3: Slurm submit job</h3><p>当我们配置好了 python 环境，我们就准备把写好的脚本提交到HPC (参考 Appendix 如何把脚本上传到HPC)。按照目前所了解的信息，HPC 中心都会要求用 slurm (workload manager) 提交任务。</p>
<p><code>vim submit.sh # 创建并进入 submit.sh 文件</code></p>
<pre class=" language-lang-Bash"><code class="language-lang-Bash">#在 vim 模式下编辑 submit.sh 的内容如下
#！/bin/bash
#SBATCH --partition=gpu_rtx  # 此处选的是gpu_rtx, 一般会提供四种partition: gpu, gpu_rtx, gpu_v100, gpu_gtx.
#SBATCH --gres=gpu：1

module load cuda/10.1
module load cudnn/7.6.5
source miniconda/bin/activate pyGPUrtx 

python xxx.py
</code></pre>
<p>退出 vim  编辑器后输入以下命令提交任务</p>
<pre class=" language-lang-bash"><code class="language-lang-bash">sbatch submit.sh #提交
#上面命令运行后，会出现类似 slurm-xxxxx.out 
# 比如: slurm-3764657.out

cat slurm-3764657.out  # 查看结果
</code></pre>
<h3 id="Appendix-上传脚本至HPC"><a href="#Appendix-上传脚本至HPC" class="headerlink" title="Appendix: 上传脚本至HPC"></a>Appendix: 上传脚本至HPC</h3><ol>
<li>FileZilla</li>
<li>Github<br>比较友好，学习成本低的方式是直接使用 FileZilla。 如果对 Github 操作熟悉的可以直接用 Github 链接文件夹（Deep_Filter), 请转这篇文章。</li>
</ol>
<h3 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h3><ol>
<li><a target="_blank" rel="noopener" href="https://sydney-informatics-hub.github.io/training.artemis.gpu/aio.html">Introduction to GPU computing on HPC</a></li>
<li><a target="_blank" rel="noopener" href="https://wiki.hpc.uconn.edu/index.php/Main_Page">Storrs HPC Cluster</a></li>
<li><a target="_blank" rel="noopener" href="http://jeremy9959.net/Math-5800-Spring-2020/Cluster.html">MATH-5800-Spring-2020</a></li>
<li><a target="_blank" rel="noopener" href="https://ulhpc-tutorials.readthedocs.io/en/latest/beginners/">Getting Started on the HL  HPC platform</a></li>
</ol>

    
  </div>

  <footer>
    
      
      
      
      
      
<div class="navi clearfix">
  
    <a href="/math/posts/a4a6adfd/" class="alignleft prev" title="Hexo Modernist 配置记录">Hexo Modernist 配置记录</a>
  
  
    <a href="/math/posts/8d2e3aa6/" class="alignright next" title="Python 札记">Python 札记</a>
  
</div>

      
  <div class="share">
    
  </div>
  <script src="http://connect.qq.com/widget/loader/loader.js" widget="shareqq" charset="utf-8"></script>

       <div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://EXAMPLE.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            
      
    
    <div class="clearfix"></div>
  </footer>
</article>

</div>
  </div>

  
  <div id="sidebar" class="widgets-right">
  
<div class="widget category">
  <h3 class="title">Categories</h3>
  <ul class="entry">
  
    <li><a href="/math/categories/Probability/Inequality/">Inequality</a><small>1</small></li>
  
    <li><a href="/math/categories/Probability/">Probability</a><small>4</small></li>
  
    <li><a href="/math/categories/Stochastic-Calculus-Notes/">Stochastic Calculus Notes</a><small>3</small></li>
  
    <li><a href="/math/categories/Tech/">Tech</a><small>2</small></li>
  
    <li><a href="/math/categories/Weak-Convergence/">Weak Convergence</a><small>2</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">Recent Posts</h3>
  <ul class="entry">
    
      <li>
        <a href="/math/posts/c5346f32/">LaTeX Note</a>
      </li>
    
      <li>
        <a href="/math/posts/a4a6adfd/">Hexo Modernist 配置记录</a>
      </li>
    
      <li>
        <a href="/math/posts/8ac8ca6d/">HPC 配置深度学习环境</a>
      </li>
    
      <li>
        <a href="/math/posts/8d2e3aa6/">Python 札记</a>
      </li>
    
      <li>
        <a href="/math/posts/aeb99872/">The Perturbed Test Function Method</a>
      </li>
    
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">Blogrolls</h3>
  <ul class="entry">
  
    
    <li><a href="https://almostsure.wordpress.com" target="_blank">Almost Sure</a></li>
  
    
    <li><a href="https://fabricebaudoin.wordpress.com" target="_blank">Research and Lecture notes</a></li>
  
    
    <li><a href="http://eufisky.is-programmer.com" target="_blank">Eufisky(In chinese)</a></li>
  
    
    <li><a href="https://usamo.wordpress.com" target="_blank">Evan Chen</a></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">Flag_counter</h3>
  <ul class="blogroll list-unstyled">
    <a target="_blank" rel="noopener" href="https://info.flagcounter.com/Nnms"><img src="https://s04.flagcounter.com/count2/Nnms/bg_C6EAFA/txt_000000/border_C6EAFA/columns_2/maxflags_20/viewers_0/labels_1/pageviews_1/flags_0/percent_0/" alt="Flag Counter" border="0"></a>
  </ul>
</div>

  
<div class="widget tagcloud">
  <h3 class="title">Tag Cloud</h3>
  <div class="entry">
    <a href="../../tags/Chebyshev-s-Inequality/" style="font-size: 10px;">Chebyshev's Inequality</a> <a href="../../tags/Filtration/" style="font-size: 10px;">Filtration</a> <a href="../../tags/Gronwall-Inequality/" style="font-size: 10px;">Gronwall Inequality</a> <a href="../../tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="../../tags/Hitting-time/" style="font-size: 10px;">Hitting time</a> <a href="../../tags/Holder-s-Inequality/" style="font-size: 10px;">Holder's Inequality</a> <a href="../../tags/Integrable/" style="font-size: 10px;">Integrable</a> <a href="../../tags/It-hat-o-integral/" style="font-size: 10px;">It$\hat{o}$ integral</a> <a href="../../tags/Jesen-s-Inequality/" style="font-size: 10px;">Jesen's Inequality</a> <a href="../../tags/Lebesgue-Integral/" style="font-size: 10px;">Lebesgue Integral</a> <a href="../../tags/Lyapunov-s-Inequality/" style="font-size: 10px;">Lyapunov's Inequality</a> <a href="../../tags/Matlab/" style="font-size: 10px;">Matlab</a> <a href="../../tags/Minkowski-s-Inequality/" style="font-size: 10px;">Minkowski's Inequality</a> <a href="../../tags/Modernist/" style="font-size: 10px;">Modernist</a> <a href="../../tags/Optional-time/" style="font-size: 10px;">Optional time</a> <a href="../../tags/Perturbed-Test-Function-Method/" style="font-size: 10px;">Perturbed Test Function Method</a> <a href="../../tags/Random-Elements/" style="font-size: 10px;">Random Elements</a> <a href="../../tags/Random-Variable/" style="font-size: 10px;">Random Variable</a> <a href="../../tags/Stochastic-Processes/" style="font-size: 10px;">Stochastic Processes</a> <a href="../../tags/Stopping-time/" style="font-size: 10px;">Stopping time</a> <a href="../../tags/Tightness/" style="font-size: 10px;">Tightness</a> <a href="../../tags/Uniformly-Integrable/" style="font-size: 10px;">Uniformly Integrable</a> <a href="../../tags/Weak-Convergence/" style="font-size: 10px;">Weak Convergence</a> <a href="../../tags/congvergence-in-probaility/" style="font-size: 10px;">congvergence in probaility</a> <a href="../../tags/convergence-almost-sure/" style="font-size: 10px;">convergence almost sure</a> <a href="../../tags/convergence-in-distribution/" style="font-size: 10px;">convergence in distribution</a> <a href="../../tags/convergence-in-mean-of-order-p/" style="font-size: 10px;">convergence in mean of order p</a> <a href="../../tags/convergence-with-probability-one/" style="font-size: 10px;">convergence with probability one</a> <a href="../../tags/perturbed-test-function-method/" style="font-size: 10px;">perturbed test function method</a> <a href="../../tags/weak-convergence/" style="font-size: 10px;">weak convergence</a>
  </div>
</div>


</div>
  
  
  <footer id="footer">
<script src="/math/js/prettify.js"></script>
<script type="text/javascript">
$(document).ready(function(){
 $('pre').addClass('prettyprint linenums');
 $('code').addClass('prettyprint');
 prettyPrint();
 })
</script>



<div class="copyright">
  
  &copy; 2021 <a href="/math/">Hongjiang Qian</a>
  
</div>

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'hjqian96';
        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>




</footer>
  <script src="//lib.sinaapp.com/js/jquery/1.8/jquery.min.js"></script>
<script src="/math/js/scale.fix.js"></script>
<script src="/math/js/jquery.imagesloaded.min.js"></script>
<script src="/math/js/gallery.js"></script>




<div id="rightfix" style="display:none;">


<a href="javascript:void(0)" id="gotop" class="fix_btn" onclick="gotop();" title="回到顶部"><i></i></a>
<script>
  function gotop(){
    $('html,body').animate({
        scrollTop : '0px'
      }, 800);
  }
  $(function(){
    _rightfix = $('#rightfix');
    $(window).scroll(function(){
      $sollTop = document.documentElement.scrollTop + document.body.scrollTop;
      if($sollTop > 350){
        _rightfix.show();
      }else{
        _rightfix.hide();
      }
    });
  });
</script>

</div>


<link rel="stylesheet" href="/math/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/math/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
  (function($){
    $('.fancybox').fancybox();
  })(jQuery);
</script>



<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>